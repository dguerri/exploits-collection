FROM gcc:13 AS builder

COPY redis-rogue-server/RedisModulesSDK /RedisModulesBuilder

RUN cd /RedisModulesBuilder/exp && \
  make clean all 

FROM python:latest AS exploit

COPY redis-rogue-server/ /redis-rogue-server/
RUN rm /redis-rogue-server/exp.so
COPY --from=builder /RedisModulesBuilder/exp/exp.so /redis-rogue-server/exp.so

WORKDIR /redis-rogue-server/
CMD ["sleep", "inf"]

FROM redis:5.0.5-alpine AS vulnerable

